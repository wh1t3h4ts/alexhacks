{% extends 'billing/admin_base.html' %}
{% load static %}
{% block title %}Plans Management - Starlex WiFi{% endblock %}
{% block page_title %}Plans Management{% endblock %}
{% block page_subtitle %}Create, edit, and manage subscription plans{% endblock %}

{% block content %}
<section class="max-w-7xl mx-auto py-8 px-4">
  <div class="flex items-center justify-between mb-8">
    <div>
      <h2 class="text-2xl font-bold text-white">Pricing Plans</h2>
      <p class="text-text-secondary mt-1">Simple, predictable pricing for teams of all sizes.</p>
    </div>
  </div>

  <div class="grid gap-6 grid-cols-1 md:grid-cols-3">
    <!-- Basic -->
    <article class="bg-bg-card border border-border rounded-xl p-6 shadow-sm hover:shadow-lg transition-all">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Basic</h3>
        <div class="text-2xl font-bold">KES 0</div>
      </div>
      <p class="text-text-secondary mb-4">Essential access for light users.</p>
      <ul class="mb-6 space-y-2 text-sm text-text-secondary">
        <li>30 minutes access</li>
        <li>Basic support</li>
        <li>Limited speed</li>
      </ul>
      <button class="w-full btn-admin btn-admin-secondary">Choose Basic</button>
    </article>

    <!-- Pro (Recommended) -->
    <article class="bg-gradient-to-br from-[#161b22] to-[#1f2937] border-2 border-accent rounded-2xl p-6 shadow-lg transform md:scale-105">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-white">Pro</h3>
        <div class="text-2xl font-bold text-white">KES 199</div>
      </div>
      <p class="text-text-secondary mb-4">Recommended for most small businesses.</p>
      <ul class="mb-6 space-y-2 text-sm text-text-secondary">
        <li>3 hours access</li>
        <li>Priority support</li>
        <li>Higher speeds</li>
      </ul>
      <button class="w-full bg-accent text-bg-main font-semibold py-2 rounded-lg hover:bg-accent-hover transition-all">Start Pro</button>
    </article>

    <!-- Enterprise -->
    <article class="bg-bg-card border border-border rounded-xl p-6 shadow-sm hover:shadow-lg transition-all">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Enterprise</h3>
        <div class="text-2xl font-bold">Custom</div>
      </div>
      <p class="text-text-secondary mb-4">Advanced features and SLA-backed support.</p>
      <ul class="mb-6 space-y-2 text-sm text-text-secondary">
        <li>Custom durations</li>
        <li>Dedicated support</li>
        <li>Service level agreement</li>
      </ul>
      <button class="w-full btn-admin btn-admin-ghost">Contact Sales</button>
    </article>
  </div>

  <!-- Mobile friendly stacked cards handled by grid -->
  <div class="mt-8">
    <h4 class="text-lg font-semibold mb-4">Compare Plans</h4>
    <div class="overflow-x-auto bg-bg-card p-4 rounded-lg">
      <table class="w-full text-left text-sm">
        <thead>
          <tr class="text-text-secondary">
            <th class="py-2">Feature</th>
            <th class="py-2">Basic</th>
            <th class="py-2">Pro</th>
            <th class="py-2">Enterprise</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="py-2 text-text-secondary">Duration</td>
            <td class="py-2">30m</td>
            <td class="py-2">3h</td>
            <td class="py-2">Custom</td>
          </tr>
          <tr>
            <td class="py-2 text-text-secondary">Support</td>
            <td class="py-2">Community</td>
            <td class="py-2">Priority</td>
            <td class="py-2">Dedicated</td>
          </tr>
          <tr>
            <td class="py-2 text-text-secondary">Speed</td>
            <td class="py-2">Standard</td>
            <td class="py-2">High</td>
            <td class="py-2">Custom</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
  // Minimal JS for CTA feedback
  document.querySelectorAll('button').forEach(btn => {
    btn.addEventListener('click', (e) => {
      if (btn.classList.contains('btn-admin-primary') || btn.textContent.includes('Start Pro') || btn.textContent.includes('Choose')) {
        btn.classList.add('opacity-80');
        setTimeout(() => btn.classList.remove('opacity-80'), 300);
      }
    });
  });

function editPlan(planId) {
  openPlanModal(planId);
  closeAllMenus();
}

function duplicatePlan(planId) {
  showToast('Plan duplicated successfully!', 'success');
  closeAllMenus();
}

function deletePlan(planId) {
  if (confirm('Are you sure you want to delete this plan? This action cannot be undone.')) {
    showToast('Plan deleted successfully!', 'success');
  }
  closeAllMenus();
}

function togglePlanMenu(planId) {
  closeAllMenus();
  document.getElementById(`menu-${planId}`).classList.toggle('hidden');
}

function closeAllMenus() {
  document.querySelectorAll('[id^="menu-"]').forEach(menu => {
    menu.classList.add('hidden');
  });
}

// Form submission
document.getElementById('planForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const formData = {
    id: document.getElementById('planId').value,
    name: document.getElementById('planName').value,
    price: document.getElementById('planPrice').value,
    duration: document.getElementById('planDuration').value,
    description: document.getElementById('planDescription').value
  };

  console.log('Saving plan:', formData);
  showToast('Plan saved successfully!', 'success');
  closePlanModal();

  // In a real implementation, this would make an AJAX call to save the plan
});

// Close modal when clicking outside
document.getElementById('planModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closePlanModal();
  }
});

// Close menus when clicking outside
document.addEventListener('click', function(e) {
  if (!e.target.closest('[onclick*="togglePlanMenu"]')) {
    closeAllMenus();
  }
});
</script>
{% endblock %}
