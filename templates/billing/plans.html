{% extends 'billing/admin_base.html' %}
{% load static %}
{% block title %}Customer Subscriptions - Starlex WiFi{% endblock %}
{% block page_title %}Customer Subscriptions{% endblock %}
{% block page_subtitle %}View all customer subscriptions and their plans{% endblock %}

{% block content %}
<section class="max-w-7xl mx-auto py-8 px-4">
  <div class="page-header">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
      <div>
        <h1 class="page-title">Customer Subscriptions</h1>
        <p class="page-subtitle">Comprehensive overview of all customer subscriptions and their active plans</p>
      </div>
      <div class="flex items-center gap-4">
        <div class="stats-card">
          <div class="stat-label">Total Subscriptions</div>
          <div class="stat-value">{{ subscriptions|length }}</div>
        </div>
        <div class="stats-card">
          <div class="stat-label">Active Plans</div>
          <div class="stat-value">{{ subscriptions|length|add:"0" }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="subscriptions-container">
    <div class="overflow-x-auto">
      <table class="subscriptions-table">
        <thead>
          <tr>
            <th>Customer</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Customer Price</th>
            <th>Plan</th>
            <th>Amount</th>
            <th>Subscribed On</th>
          </tr>
        </thead>
                <tbody>
          {% for subscription in subscriptions %}
          <tr>
            <td>
              <div class="customer-name">
                <div class="customer-avatar">
                  {{ subscription.customer.user.get_full_name|default:subscription.customer.user.username|slice:":1"|upper }}
                </div>
                <div>
                  <div class="font-semibold">{{ subscription.customer.user.get_full_name|default:subscription.customer.user.username }}</div>
                  <div class="text-xs text-text-secondary">@{{ subscription.customer.user.username }}</div>
                </div>
              </div>
            </td>
            <td class="text-text-secondary">{{ subscription.customer.user.email }}</td>
            <td class="text-text-secondary">{{ subscription.customer.phone|default:"N/A" }}</td>
            <td class="amount-highlight">${{ subscription.customer.price|floatformat:2 }}</td>
            <td>
              {% if subscription.has_transaction %}
                <span class="plan-badge">{{ subscription.plan.name }}</span>
              {% else %}
                <span class="plan-badge" style="background: rgba(156, 163, 175, 0.1); color: var(--color-text-secondary);">
                  No Plan
                </span>
              {% endif %}
            </td>
            <td class="amount-highlight">
              {% if subscription.has_transaction %}
                ${{ subscription.amount }}
              {% else %}
                -
              {% endif %}
            </td>
            <td class="date-time">
              {% if subscription.has_transaction %}
                {{ subscription.paid_at|date:"M d, Y" }}<br>{{ subscription.paid_at|date:"H:i" }}
              {% else %}
                Never
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="empty-state">
              <i class="bi bi-people"></i>
              <div>No customers found.</div>
              <small>Add customers through the Customers page to see them here.</small>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}
